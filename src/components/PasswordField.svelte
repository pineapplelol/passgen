<script lang="ts">
  import { createEventDispatcher } from 'svelte';
  import ShadowClipboard from './ShadowClipboard.svelte';

  export let strength: number;
  export let currentPassword: string;
  const dispatch = createEventDispatcher();

  function generatePassword() {
    dispatch('generate');
  }

  function updateCurrentPassword() {
    dispatch('updateCurrentPassword', { newPassword: currentPassword });
  }

  const copyToClipboard = () => {
    const app = new ShadowClipboard({
      target: document.getElementById('clipboard'),
      props: { name: currentPassword },
    });
    app.$destroy();
  };
</script>

<style>
  div {
    width: 100%;
    display: flex;
  }

  #field {
    height: 69px;
  }

  #bar {
    height: 8px;
    background-color: white;
    display: flex;
  }

  #bar span {
    background-color: var(--green);
    transition: padding 0.2s ease-in-out;
  }

  input {
    flex: 8;
    background: none;
    border: none;
    font-size: 24px;
    color: var(--font);
    font-family: var(--mono);
    padding-left: 26px;
  }

  button {
    flex: 1;
    background: none;
    color: var(--accent);
    font-size: 32px;
    border: none;
    outline: none;
    cursor: pointer;
    transition: transform 1s;
  }

  button:active svg {
    transform: scale(1.1);
  }

  button.spin {
    transition: none;
  }

  button.spin:active {
    animation: spin 1s;
  }

  @-moz-keyframes spin {
    from {
      -moz-transform: rotate(0deg);
    }
    to {
      -moz-transform: rotate(360deg);
    }
  }
  @-webkit-keyframes spin {
    from {
      -webkit-transform: rotate(0deg);
    }
    to {
      -webkit-transform: rotate(360deg);
    }
  }
  @keyframes spin {
    from {
      transform: rotate(0deg);
    }
    to {
      transform: rotate(360deg);
    }
  }
</style>

<section>
  <div id="field" role="form">
    <input bind:value={currentPassword} on:input={updateCurrentPassword} />
    <button on:click={copyToClipboard}>
      <svg
        width="24"
        height="24"
        viewBox="0 0 24 24"
        fill="none"
        xmlns="http://www.w3.org/2000/svg">
        <title>Copy this password</title>
        <path d="M13 7H7V5H13V7Z" fill="currentColor" />
        <path d="M13 11H7V9H13V11Z" fill="currentColor" />
        <path d="M7 15H13V13H7V15Z" fill="currentColor" />
        <path
          fill-rule="evenodd"
          clip-rule="evenodd"
          d="M3 19V1H17V5H21V23H7V19H3ZM15 17V3H5V17H15ZM17 7V19H9V21H19V7H17Z"
          fill="currentColor" />
      </svg>
    </button>
    <button on:click={generatePassword} class="spin">
      <svg
        width="24"
        height="24"
        viewBox="0 0 24 24"
        fill="none"
        xmlns="http://www.w3.org/2000/svg">
        <title>Generate a new password</title>
        <path
          d="M4.56079 10.6418L6.35394 3.94971L8.25402 5.84979C11.7312 3.6588 16.3814 4.07764 19.41 7.1063L17.9958 8.52052C15.7536 6.27827 12.3686 5.87519 9.71551 7.31128L11.2529 8.84869L4.56079 10.6418Z"
          fill="currentColor" />
        <path
          d="M19.4392 13.3581L17.646 20.0502L15.7459 18.1501C12.2688 20.3411 7.61857 19.9223 4.58991 16.8936L6.00413 15.4794C8.24638 17.7217 11.6313 18.1247 14.2844 16.6887L12.747 15.1512L19.4392 13.3581Z"
          fill="currentColor" />
      </svg>
    </button>
  </div>
  <div id="bar" role="progressbar">
    <span style={`padding-left: ${strength || 0}%`} />
  </div>
</section>

<div id="clipboard" />
